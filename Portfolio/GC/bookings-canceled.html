<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Amber ‚Ä¢ Canceled Bookings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="bookings.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </head>
  <body>
    <header class="topbar">
      <button class="menu-toggle" aria-label="Toggle menu" id="menuToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="brand">
        <span class="logo-dot"></span>
        <span class="brand-name">Amber</span>
      </div>

      <form class="search" role="search" action="#">
        <input type="text" placeholder="Search bookings..." aria-label="Search bookings" />
        <button type="submit" aria-label="Search">üîç</button>
      </form>

      <nav class="top-actions" aria-label="Top actions">
        <a href="notifications.html" class="action"><span>üîî</span><span class="label">Notification</span></a>
        <a href="#" class="action"><span>üë§</span><span class="label">Profile</span></a>
      </nav>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <nav class="mobile-menu" id="mobileMenu" aria-label="Mobile navigation">
      <a class="mobile-nav-item" href="home.html"><span>üè†</span>Home</a>
      <a class="mobile-nav-item" href="activities.html"><span>üéØ</span>Activities</a>
      <a class="mobile-nav-item active" href="bookings-canceled.html"><span>üìÖ</span>Booking</a>
      <a class="mobile-nav-item" href="location.html"><span>üìç</span>Location</a>
      <a class="mobile-nav-item" href="Settings.html"><span>‚öôÔ∏è</span>Settings</a>
    </nav>

    <div class="layout">
      <aside class="sidebar" aria-label="Main navigation">
        <a class="nav-item" href="home.html"><span>üè†</span>Home</a>
        <a class="nav-item" href="activities.html"><span>üéØ</span>Activities</a>
        <a class="nav-item active" href="bookings-upcoming.html"><span>üìÖ</span>Bookings</a>
        <a class="nav-item" href="location.html"><span>üìç</span>Location</a>
        <a class="nav-item" href="Settings.html"><span>‚öôÔ∏è</span>Settings</a>

        <div class="promos">
          <div class="promo">
            <h4>Weekend Retreat</h4>
            <p>Recharge with 2 days of yoga & breath work.</p>
            <button class="chip">View Retreat</button>
          </div>
          <div class="promo">
            <h4>Weekend Retreat</h4>
            <p>Recharge with 2 days of yoga & breath work.</p>
            <button class="chip ghost">Claim Offer</button>
          </div>
          <div class="promo">
            <h4>Weekend Retreat</h4>
            <p>Recharge with 2 days of yoga & breath work.</p>
            <button class="chip ghost">See Schedule</button>
          </div>
        </div>
      </aside>

      <main class="content bookings">
        <h2 class="section-title">My Bookings</h2>

        <!-- Navigation Tabs -->
        <div class="filter-tabs">
          <a href="bookings-upcoming.html" class="filter-tab">Upcoming</a>
          <a href="bookings-completed.html" class="filter-tab">Completed</a>
          <a href="bookings-canceled.html" class="filter-tab active">Canceled</a>
        </div>

        <!-- Bookings Grid -->
        <div class="bookings-grid">
          <!-- Static Canceled Bookings -->
          <article class="booking-card canceled" data-status="canceled">
            <div class="booking-header">
              <div class="booking-status canceled">
                <span class="status-dot"></span>
                <span class="status-text">Canceled</span>
              </div>
              <div class="booking-date">Dec 5, 2024</div>
            </div>
            <div class="booking-content">
              <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?q=80&w=1200&auto=format&fit=crop" alt="Pottery Workshop" />
              <div class="booking-details">
                <h3>Pottery Workshop</h3>
                <div class="booking-meta">
                  <div class="meta-item">
                    <span class="meta-icon">üïê</span>
                    <span>Sat, 10:00 AM</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">üìç</span>
                    <span>Art Studio</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">üë§</span>
                    <span>Instructor: James Wilson</span>
                  </div>
                </div>
                <div class="booking-actions">
                  <button class="btn secondary">View Details</button>
                </div>
              </div>
            </div>         
          </article>

          <article class="booking-card canceled" data-status="canceled">
            <div class="booking-header">
              <div class="booking-status canceled">
                <span class="status-dot"></span>
                <span class="status-text">Canceled</span>
              </div>
              <div class="booking-date">Dec 3, 2024</div>
            </div>
            <div class="booking-content">
              <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=1200&auto=format&fit=crop" alt="Meditation Retreat" />
              <div class="booking-details">
                <h3>Meditation Retreat</h3>
                <div class="booking-meta">
                  <div class="meta-item">
                    <span class="meta-icon">üïê</span>
                    <span>Sun, 9:00 AM</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">üìç</span>
                    <span>Peace Garden</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">üë§</span>
                    <span>Instructor: Anna Patel</span>
                  </div>
                </div>
                <div class="booking-actions">
                  <button class="btn secondary">View Details</button>
                </div>
              </div>
            </div>
          </article>
        </div>

        <!-- Empty State -->
        <div class="empty-state" style="display: none;">
          <div class="empty-icon">üìÖ</div>
          <h3>No canceled bookings found</h3>
          <p>You don't have any canceled bookings at this time.</p>
          <button class="btn primary">Browse Activities</button>
        </div>
      </main>
    </div>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Connect With Us</h3>
          <p>Follow us on social media to get the latest news</p>
          <div class="social-links">
            <a href="https://www.facebook.com/share/17bD2Xt7NX/" class="social-link" target="_blank" rel="noopener noreferrer">
              <img src="https://static.vecteezy.com/system/resources/previews/018/930/698/non_2x/facebook-logo-facebook-icon-transparent-free-png.png" alt="Facebook">
            </a>
            <a href="https://www.instagram.com/amberchamber.ss15?igsh=MTltaGdvaXBpOGVtYQ==" class="social-link" target="_blank" rel="noopener noreferrer">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/1200px-Instagram_icon.png" alt="Instagram">
            </a>
          </div>
          <div class="policy-links">
            <a href="#" class="policy-link">COOKIES POLICY</a>
            <a href="#" class="policy-link">PRIVACY POLICY</a>
            <a href="#" class="policy-link">TERMS AND CONDITIONS</a>
          </div>
        </div>
        
        <div class="footer-section">
          <h3>Explore More</h3>
          <ul class="footer-links">
            <li><a href="#">About Us</a></li>
            <li><a href="#">Founder Message</a></li>
            <li><a href="#">Our Concepts</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h3>Our Studios</h3>
          <ul class="footer-links">
            <li><a href="location.html">Our Locations</a></li>
            <li><a href="#">Past Events</a></li>
            <li><a href="#">Opportunities</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>Copyright ¬© 2024. Amber Sdn Bhd. All rights reserved</p>
      </div>
    </footer>

    <!-- View Detail Modal -->
    <div class="modal-overlay" id="viewDetailModal">
      <div class="modal view-detail-modal">
        <div class="modal-header">
          <h2>Booking Details</h2>
          <button class="close-btn" onclick="closeViewDetailModal()">&times;</button>
        </div>
        
        <div class="booking-detail-content" id="bookingDetailContent">
          <!-- Booking details will be populated here -->
        </div>
        
        <div class="modal-buttons">
          <button class="btn secondary" onclick="closeViewDetailModal()">Close</button>
        </div>
      </div>
    </div>

    <script>
      // Load bookings from localStorage and display only canceled ones
      function loadBookingsFromStorage() {
        try {
          var storedBookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
          var bookingsGrid = document.querySelector('.bookings-grid');
          var emptyState = document.querySelector('.empty-state');
          console.log('Loading canceled bookings from storage:', storedBookings);
          
          // Clear existing dynamic bookings
          var existingDynamicBookings = document.querySelectorAll('.booking-card[data-dynamic="true"]');
          existingDynamicBookings.forEach(booking => booking.remove());
          
          // Filter and add only canceled bookings
          var canceledBookings = storedBookings.filter(function(booking) {
            return booking.status === 'canceled';
          });
          
          canceledBookings.forEach(function(booking) {
            var bookingCard = createBookingCard(booking);
            bookingsGrid.insertBefore(bookingCard, bookingsGrid.firstChild);
          });
          
          // Show empty state if no bookings
          var staticBookings = document.querySelectorAll('.booking-card:not([data-dynamic])');
          if (canceledBookings.length === 0 && staticBookings.length === 0) {
            emptyState.style.display = 'block';
          } else {
            emptyState.style.display = 'none';
          }
          
          console.log('Added', canceledBookings.length, 'canceled bookings to display');
          
        } catch(e) {
          console.error('Failed to load bookings from storage', e);
        }
      }
      
      // Create a booking card element
      function createBookingCard(booking) {
        var card = document.createElement('article');
        card.className = 'booking-card canceled';
        card.setAttribute('data-status', 'canceled');
        card.setAttribute('data-dynamic', 'true');
        card.setAttribute('data-booking-id', booking.id);
        
        var dateObj = new Date(booking.date);
        var formattedDate = dateObj.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric' 
        });
        
        // Extract day of week and start time
        var dayOfWeek = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
        var startTime = booking.time.split(' - ')[0];
        var timeOnly = startTime.replace(/\s*(AM|PM)/i, '');
        var period = startTime.match(/\s*(AM|PM)/i) ? startTime.match(/\s*(AM|PM)/i)[1] : '';
        var formattedDateTime = dayOfWeek + ' ' + timeOnly.toLowerCase() + period.toLowerCase();
        
        card.innerHTML = `
          <div class="booking-header">
            <div class="booking-status canceled">
              <span class="status-dot"></span>
              <span class="status-text">Canceled</span>
            </div>
            <div class="booking-date">${formattedDate}</div>
          </div>
          <div class="booking-content">
            <img src="https://images.unsplash.com/photo-1518617840859-acd0eac7b3fd?q=80&w=1200&auto=format&fit=crop" alt="${booking.activity}" />
            <div class="booking-details">
              <h3>${booking.activity}</h3>
              <div class="booking-meta">
                <div class="meta-item">
                  <span class="meta-icon">üïê</span>
                  <span>${formattedDateTime}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-icon">üë•</span>
                  <span>${booking.numberOfPeople} person${booking.numberOfPeople > 1 ? 's' : ''}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-icon">üí≥</span>
                  <span>Paid via ${booking.paymentMethod}</span>
                </div>
              </div>
              <div class="booking-actions">
                <button class="btn secondary" onclick="openViewDetailModal(${booking.id})">View Details</button>
              </div>
            </div>
          </div>
        `;
        
        return card;
      }
      
      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        loadBookingsFromStorage();
        
        // Search functionality
        const searchInput = document.querySelector('.search input');
        const bookingCards = document.querySelectorAll('.booking-card');
        const emptyState = document.querySelector('.empty-state');
        
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          let visibleCount = 0;

          bookingCards.forEach(card => {
            const cardText = card.textContent.toLowerCase();
            if (cardText.includes(searchTerm)) {
              card.style.display = 'block';
              visibleCount++;
            } else {
              card.style.display = 'none';
            }
          });

          if (visibleCount === 0 && searchTerm !== '') {
            emptyState.style.display = 'block';
          } else {
            emptyState.style.display = 'none';
          }
        });

        document.querySelector('.search')?.addEventListener('submit', (e) => e.preventDefault());
        
        // Add click handlers for static booking cards' View Detail buttons
        document.querySelectorAll('.booking-card:not([data-dynamic]) .btn.secondary').forEach(function(button) {
          if (button.textContent.trim() === 'View Detail' || button.textContent.trim() === 'View Details') {
            button.addEventListener('click', function() {
              var bookingCard = this.closest('.booking-card');
              var title = bookingCard.querySelector('h3').textContent;
              var date = bookingCard.querySelector('.booking-date').textContent;
              var metaItems = bookingCard.querySelectorAll('.meta-item');
              
              var parsedDate = new Date(date);
              if (isNaN(parsedDate.getTime())) {
                parsedDate = new Date();
              }
              
              var mockBooking = {
                id: 'static-' + Date.now(),
                activity: title,
                date: parsedDate.toISOString(),
                time: metaItems[0] ? metaItems[0].textContent.replace(/üïê\s*/, '').trim() : '',
                numberOfPeople: 1,
                paymentMethod: 'Credit Card',
                pricePerPerson: '0',
                totalPrice: '0',
                bookingDate: new Date().toISOString(),
                status: 'canceled',
                bookingFor: 'myself'
              };
              
              openViewDetailModalWithBooking(mockBooking);
            });
          }
        });
      });

      // View Detail Modal functionality
      function openViewDetailModal(bookingId) {
        try {
          var storedBookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
          var booking = storedBookings.find(b => b.id == bookingId);
          
          if (!booking) {
            alert('Booking not found');
            return;
          }
          
          openViewDetailModalWithBooking(booking);
          
        } catch(e) {
          console.error('Failed to open view detail modal', e);
          alert('Failed to load booking details');
        }
      }
      
      function openViewDetailModalWithBooking(booking) {
        try {
          var dateObj = new Date(booking.date);
          var formattedDate = dateObj.toLocaleDateString('en-US', { 
            weekday: 'long',
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
          
          var bookingTime = booking.bookingDate ? new Date(booking.bookingDate) : new Date();
          var formattedBookingTime = bookingTime.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          var canceledDate = booking.canceledDate ? new Date(booking.canceledDate).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }) : 'N/A';
          
          var myselfSection = '';
          if (booking.bookingFor !== 'friend_only') {
            myselfSection = '<div class="detail-section"><h4>üë§ Myself:</h4><ul class="friends-list"><li>You (Main Book)</li></ul></div>';
          }
          
          var friendsList = '';
          if (booking.friends && booking.friends.length > 0) {
            friendsList = '<div class="detail-section"><h4>üë• Friends Booked For:</h4><ul class="friends-list">';
            booking.friends.forEach(function(friend) {
              friendsList += '<li>' + (friend.name || 'Friend') + ' - ' + (friend.email || 'No email provided') + '</li>';
            });
            friendsList += '</ul></div>';
          }
          
          var detailContent = `
            <div class="booking-detail-info">
              <div class="detail-section">
                <h3>${booking.activity}</h3>
                <div class="detail-item">
                  <span class="detail-label">üìÖ Date:</span>
                  <span class="detail-value">${formattedDate}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üïê Time:</span>
                  <span class="detail-value">${booking.time}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üë• Number of People:</span>
                  <span class="detail-value">${booking.numberOfPeople || 1} person${(booking.numberOfPeople || 1) > 1 ? 's' : ''}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üí≥ Payment Method:</span>
                  <span class="detail-value">${booking.paymentMethod || 'N/A'}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üí∞ Price per Person:</span>
                  <span class="detail-value">RM ${booking.pricePerPerson || '0'}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üíµ Total Amount:</span>
                  <span class="detail-value">RM ${booking.totalPrice || '0'}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üìù Booking Date:</span>
                  <span class="detail-value">${formattedBookingTime}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üö´ Canceled Date:</span>
                  <span class="detail-value">${canceledDate}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">üìä Status:</span>
                  <span class="detail-value status-canceled">Canceled</span>
                </div>
              </div>
              ${myselfSection}
              ${friendsList}
            </div>
          `;
          
          document.getElementById('bookingDetailContent').innerHTML = detailContent;
          document.getElementById('viewDetailModal').classList.add('active');
          
        } catch(e) {
          console.error('Failed to open view detail modal', e);
          alert('Failed to load booking details');
        }
      }
      
      function closeViewDetailModal() {
        document.getElementById('viewDetailModal').classList.remove('active');
      }

      // Close modals when clicking outside
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal-overlay')) {
          if (e.target.id === 'viewDetailModal') {
            closeViewDetailModal();
          }
        }
      });

      // Mobile Menu Toggle
      (function(){
        var menuToggle = document.getElementById('menuToggle');
        var mobileMenu = document.getElementById('mobileMenu');
        var mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
        var isOpen = false;

        function openMenu(){
          isOpen = true;
          mobileMenu.classList.add('open');
          mobileMenuOverlay.classList.add('active');
          document.body.style.overflow = 'hidden';
          menuToggle.classList.add('active');
        }

        function closeMenu(){
          isOpen = false;
          mobileMenu.classList.remove('open');
          mobileMenuOverlay.classList.remove('active');
          document.body.style.overflow = '';
          menuToggle.classList.remove('active');
        }

        if(menuToggle){
          menuToggle.addEventListener('click', function(){
            if(isOpen){
              closeMenu();
            } else {
              openMenu();
            }
          });
        }

        if(mobileMenuOverlay){
          mobileMenuOverlay.addEventListener('click', closeMenu);
        }

        if(mobileMenu){
          mobileMenu.querySelectorAll('.mobile-nav-item').forEach(function(item){
            item.addEventListener('click', function(){
              closeMenu();
            });
          });
        }
      })();
    </script>
  </body>
</html>

